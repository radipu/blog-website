@model My_Blog_Website.ViewModels.HomeViewModel
@using My_Blog_Website.Helpers
@using My_Blog_Website.ViewModels
@{
    ViewData["Title"] = "Home";
}

<!DOCTYPE html>
<html lang="en" class="no-js">
    <body>

        <!-- Latest 5 -->
        <div class="container-fluid paddding mb-5">
            <div class="row mx-0 hot_topic">
                <!-- Main Post -->
                <div class="col-md-6 col-12 paddding animate-box">
                    @if(Model.LatestPost.Any())
                    {
                        var mainPost = Model.LatestPost.First();
                        <div class="fh5co_suceefh5co_height">
                            <a asp-controller="Posts" asp-action="Single" asp-route-category="@URLHelper.GenerateCategorySlug(mainPost.Categories)" asp-route-slug="@URLHelper.GeneratePostSlug(mainPost.Title)">
                                <img src="@mainPost.FeatureImageUrl" alt="@mainPost.Title" 
                                     style="width:100%; height:650px; object-fit:cover"/>
                            </a>
                            <div class="fh5co_suceefh5co_height_position_absolute_font">
                                <div class="color_fff">
                                    <i class="fa fa-clock-o"></i> 
                                    @mainPost.PublishedDate?.ToString("MMM dd, yyyy")
                                </div>
                                <div>
                                    <a asp-controller="Posts" asp-action="Single" asp-route-category="@URLHelper.GenerateCategorySlug(mainPost.Categories)" asp-route-slug="@URLHelper.GeneratePostSlug(mainPost.Title)">
                                        <h2>@mainPost.Title</h2>
                                    </a>
                                </div>
                                <div>
                                    <a asp-controller="Posts" asp-action="Single" asp-route-category="@URLHelper.GenerateCategorySlug(mainPost.Categories)" asp-route-slug="@URLHelper.GeneratePostSlug(mainPost.Title)">
                                        <h3>@mainPost.PostDescription</h3>
                                    </a>
                                </div>
                            </div>
                        </div>
                    }
                </div>

                <!-- Grid Posts -->
                <div class="col-md-6">
                    <div class="row">
                        @foreach(var post in Model.LatestPost.Skip(1).Take(4))
                        {
                            <div class="col-md-6 col-6 paddding animate-box">
                                <div class="fh5co_suceefh5co_height_2">
                                    <a asp-controller="Posts" asp-action="Single" asp-route-category="@URLHelper.GenerateCategorySlug(post.Categories)" asp-route-slug="@URLHelper.GeneratePostSlug(post.Title)">
                                        <img src="@post.FeatureImageUrl" alt="@post.Title" 
                                             style="width:100%; height:300px; object-fit:cover"/>
                                    </a>
                                    <div class="fh5co_suceefh5co_height_position_absolute_font_2">
                                        <div class="color_fff">
                                            <i class="fa fa-clock-o"></i> 
                                            @post.PublishedDate?.ToString("MMM dd, yyyy")
                                        </div>
                                        <div>
                                            <a asp-controller="Posts" asp-action="Single" asp-route-category="@URLHelper.GenerateCategorySlug(post.Categories)" asp-route-slug="@URLHelper.GeneratePostSlug(post.Title)">
                                                <h2 style="color: white">@post.Title</h2>
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                </div>
            </div>
        </div>

        <!-- Thoughts Section (Max 4 items) -->
        @if (Model.Thoughts != null && Model.Thoughts.Any())
        {
            var itemCount = Model.Thoughts.Count;
            <div class="container-fluid pb-4 pt-5">
                <div class="container animate-box">
                    <div>
                        <div class="fh5co_heading fh5co_heading_border_bottom py-2 mb-4">Thoughts</div>
                    </div>
            
                    @if (itemCount > 4)
                    {
                        <div class="owl-carousel owl-theme" id="slider1">
                            @foreach (var post in Model.Thoughts)
                            {
                                <div class="item px-2">
                                    <div class="fh5co_hover_news_img">
                                        <div class="fh5co_news_img">
                                            <a asp-controller="Posts" asp-action="Single" 
                                               asp-route-category="@URLHelper.GenerateCategorySlug(post.Categories)" 
                                               asp-route-slug="@post.Slug">
                                                <img src="@post.FeatureImageUrl" alt="@post.Title" 
                                                     class="img-fluid" style="height: 200px; object-fit: cover;">
                                            </a>
                                        </div>
                                        <div class="pt-2">
                                            <a asp-controller="Posts" asp-action="Single" 
                                               asp-route-category="@URLHelper.GenerateCategorySlug(post.Categories)" 
                                               asp-route-slug="@post.Slug" 
                                               class="d-block fh5co_small_post_heading">
                                                <span class="">@post.Title</span>
                                            </a>
                                            <div class="c_g">
                                                <i class="fa fa-clock-o"></i> 
                                                @post.PublishedDate?.ToString("MMM dd, yyyy")
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            }
                        </div>
                    }
                    else
                    {
                        <div class="row g-4">
                            @foreach (var post in Model.Thoughts)
                            {
                                <div class="col-xl-3 col-lg-4 col-md-6">
                                    <div class="fh5co_hover_news_img">
                                        <div class="fh5co_news_img">
                                            <a asp-controller="Posts" asp-action="Single" 
                                               asp-route-category="@URLHelper.GenerateCategorySlug(post.Categories)" 
                                               asp-route-slug="@post.Slug">
                                                <img src="@post.FeatureImageUrl" alt="@post.Title" 
                                                     class="img-fluid" style="height: 200px; object-fit: cover;">
                                            </a>
                                        </div>
                                        <div class="pt-2">
                                            <a asp-controller="Posts" asp-action="Single" 
                                               asp-route-category="@URLHelper.GenerateCategorySlug(post.Categories)" 
                                               asp-route-slug="@post.Slug" 
                                               class="d-block fh5co_small_post_heading">
                                                <span class="">@post.Title</span>
                                            </a>
                                            <div class="c_g">
                                                <i class="fa fa-clock-o"></i> 
                                                @post.PublishedDate?.ToString("MMM dd, yyyy")
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            }
                        </div>
                    }
                </div>
            </div>
        }

        <!-- Technology Section (Max 3 items) -->
        @if (Model.Technology != null && Model.Technology.Any())
        {
            var itemCount = Model.Technology.Count;
            <div class="container-fluid pb-4 pt-5">
                <div class="container animate-box">
                    <div>
                        <div class="fh5co_heading fh5co_heading_border_bottom py-2 mb-4">Technology</div>
                    </div>
            
                    @if (itemCount > 3)
                    {
                        <div class="owl-carousel owl-theme" id="slider2">
                            @foreach (var post in Model.Technology)
                            {
                                <div class="item px-2">
                                    <div class="fh5co_hover_news_img h-100 d-flex flex-column">
                                        <div class="fh5co_news_img flex-grow-1">
                                            <a asp-controller="Posts" asp-action="Single" 
                                               asp-route-category="@URLHelper.GenerateCategorySlug(post.Categories)" 
                                               asp-route-slug="@post.Slug"
                                               class="h-100 d-block">
                                                <img src="@post.FeatureImageUrl" alt="@post.Title" 
                                                     class="img-fluid h-100 w-100" 
                                                     style="object-fit: cover;">
                                            </a>
                                        </div>
                                        <div class="pt-2">
                                            <div class="pt-2">
                                                <a asp-controller="Posts" asp-action="Single" 
                                                   asp-route-category="@URLHelper.GenerateCategorySlug(post.Categories)" 
                                                   asp-route-slug="@post.Slug" 
                                                   class="d-block fh5co_small_post_heading">
                                                    <span class="">@post.Title</span>
                                                </a>
                                                <div class="c_g">
                                                    <i class="fa fa-clock-o"></i> 
                                                    @post.PublishedDate?.ToString("MMM dd, yyyy")
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            }
                        </div>
                    }
                    else
                    {
                        <div class="row g-4">
                            @foreach (var post in Model.Technology)
                            {
                                <div class="col-xl-4 col-lg-6 col-md-6 col-sm-12">
                                    <div class="fh5co_hover_news_img h-100 d-flex flex-column">
                                        <div class="fh5co_news_img flex-grow-1">
                                            <a asp-controller="Posts" asp-action="Single" 
                                               asp-route-category="@URLHelper.GenerateCategorySlug(post.Categories)" 
                                               asp-route-slug="@post.Slug"
                                               class="h-100 d-block">
                                                <img src="@post.FeatureImageUrl" alt="@post.Title" 
                                                     class="img-fluid h-100 w-100" 
                                                     style="object-fit: cover;">
                                            </a>
                                        </div>
                                        <div class="pt-2">
                                            <div class="pt-2">
                                                <a asp-controller="Posts" asp-action="Single" 
                                                   asp-route-category="@URLHelper.GenerateCategorySlug(post.Categories)" 
                                                   asp-route-slug="@post.Slug" 
                                                   class="d-block fh5co_small_post_heading">
                                                    <span class="">@post.Title</span>
                                                </a>
                                                <div class="c_g">
                                                    <i class="fa fa-clock-o"></i> 
                                                    @post.PublishedDate?.ToString("MMM dd, yyyy")
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            }
                        </div>
                    }
                </div>
            </div>
        }

        <!-- Ideas Section (Max 3 items) -->
        @if (Model.Ideas != null && Model.Ideas.Any())
        {
            var itemCount = Model.Ideas.Count;
            <div class="container-fluid pb-4 pt-5">
                <div class="container animate-box">
                    <div>
                        <div class="fh5co_heading fh5co_heading_border_bottom py-2 mb-4">Ideas</div>
                    </div>
            
                    @if (itemCount > 3)
                    {
                        <div class="owl-carousel owl-theme" id="slider3">
                            @foreach (var post in Model.Ideas)
                            {
                                <div class="item px-2">
                                    <div class="fh5co_hover_news_img h-100 d-flex flex-column">
                                        <div class="fh5co_news_img flex-grow-1">
                                            <a asp-controller="Posts" asp-action="Single" 
                                               asp-route-category="@URLHelper.GenerateCategorySlug(post.Categories)" 
                                               asp-route-slug="@post.Slug"
                                               class="h-100 d-block">
                                                <img src="@post.FeatureImageUrl" alt="@post.Title" 
                                                     class="img-fluid h-100 w-100" 
                                                     style="object-fit: cover;">
                                            </a>
                                        </div>
                                        <div class="pt-2">
                                            <div class="pt-2">
                                                <a asp-controller="Posts" asp-action="Single" 
                                                   asp-route-category="@URLHelper.GenerateCategorySlug(post.Categories)" 
                                                   asp-route-slug="@post.Slug" 
                                                   class="d-block fh5co_small_post_heading">
                                                    <span class="">@post.Title</span>
                                                </a>
                                                <div class="c_g">
                                                    <i class="fa fa-clock-o"></i> 
                                                    @post.PublishedDate?.ToString("MMM dd, yyyy")
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            }
                        </div>
                    }
                    else
                    {
                        <div class="row g-4">
                            @foreach (var post in Model.Ideas)
                            {
                                <div class="col-xl-4 col-lg-6 col-md-6 col-sm-12">
                                    <div class="fh5co_hover_news_img h-100 d-flex flex-column">
                                        <div class="fh5co_news_img flex-grow-1">
                                            <a asp-controller="Posts" asp-action="Single" 
                                               asp-route-category="@URLHelper.GenerateCategorySlug(post.Categories)" 
                                               asp-route-slug="@post.Slug"
                                               class="h-100 d-block">
                                                <img src="@post.FeatureImageUrl" alt="@post.Title" 
                                                     class="img-fluid h-100 w-100" 
                                                     style="object-fit: cover;">
                                            </a>
                                        </div>
                                        <div class="pt-2">
                                            <div class="pt-2">
                                                <a asp-controller="Posts" asp-action="Single" 
                                                   asp-route-category="@URLHelper.GenerateCategorySlug(post.Categories)" 
                                                   asp-route-slug="@post.Slug" 
                                                   class="d-block fh5co_small_post_heading">
                                                    <span class="">@post.Title</span>
                                                </a>
                                                <div class="c_g">
                                                    <i class="fa fa-clock-o"></i> 
                                                    @post.PublishedDate?.ToString("MMM dd, yyyy")
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            }
                        </div>
                    }
                </div>
            </div>
        }

        <!-- HowTo Section -->
        @if(Model.HowTo != null && Model.HowTo.Any())
            {
                <div class="container-fluid pb-4 pt-4 paddding">
                    <div class="container paddding">
                        <div class="row mx-0">
                            <div class="col-md-8 animate-box" data-animate-effect="fadeInLeft">
                                <div>
                                    <div class="fh5co_heading fh5co_heading_border_bottom py-2 mb-4">How To</div>
                                </div>
                                @foreach(var (post, index) in Model.HowTo.Select((p, i) => (p, i)))
                                {
                                    <div class="carousel-page" data-page="@((index / 4) + 1)" style="display: none;">
                                        <!-- Replace with your actual post content -->
                                        <div class="row pb-4">
                                            <div class="col-md-5">
                                                <div class="fh5co_hover_news_img">
                                                    <a asp-controller="Posts" asp-action="Single" 
                                                       asp-route-category="@URLHelper.GenerateCategorySlug(post.Categories)" 
                                                       asp-route-slug="@post.Slug">
                                                        <img src="@post.FeatureImageUrl" alt="@post.Title" 
                                                             style="width:100%; height:200px; object-fit:cover"/>
                                                    </a>
                                                </div>
                                            </div>
                                            <div class="col-md-7">
                                                <a asp-controller="Posts" asp-action="Single" 
                                                   asp-route-category="@URLHelper.GenerateCategorySlug(post.Categories)" 
                                                   asp-route-slug="@post.Slug" 
                                                   class="d-block fh5co_small_post_heading">
                                                    <span>@post.Title</span>
                                                </a>
                                                <div>
                                                    <a asp-controller="Posts" asp-action="Single" 
                                                       asp-route-category="@URLHelper.GenerateCategorySlug(post.Categories)" 
                                                       asp-route-slug="@URLHelper.GeneratePostSlug(post.Title)">
                                                        @post.PostDescription
                                                    </a>
                                                </div>
                                                <div class="c_g">
                                                    <i class="fa fa-clock-o"></i> 
                                                    @post.PublishedDate?.ToString("MMM dd, yyyy")
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                }
                            </div>
                            <div class="col-md-3 animate-box" data-animate-effect="fadeInRight">
                                <div>
                                    <div class="fh5co_heading fh5co_heading_border_bottom py-2 mb-4">Tags</div>
                                </div>
                                <div class="clearfix"></div>
                                <div class="fh5co_tags_all">
                                    @if (Model.Tags != null && Model.Tags.Any())
                                    {
                                        @foreach (var tag in Model.Tags)
                                        {
                                            <a href="@Url.Action("PostsByTag", "Home", new { tag = tag })" class="fh5co_tagg">@tag</a>
                                        }
                                    }
                                    else
                                    {
                                        <p>No tags available.</p>
                                    }
                                </div>
                                <div>
                                    <div class="fh5co_heading fh5co_heading_border_bottom pt-3 py-2 mb-4">Most Popular</div>
                                </div>
                                <div class="row pb-3">
                                    <div class="col-5 align-self-center">
                                        <img src="images/download (1).jpg" alt="img" class="fh5co_most_trading"/>
                                    </div>
                                    <div class="col-7 paddding">
                                        <div class="most_fh5co_treding_font"> Magna aliqua ut enim ad minim veniam quis nostrud.</div>
                                        <div class="most_fh5co_treding_font_123"> April 18, 2016</div>
                                    </div>
                                </div>
                                <div class="row pb-3">
                                    <div class="col-5 align-self-center">
                                        <img src="images/allef-vinicius-108153.jpg" alt="img" class="fh5co_most_trading"/>
                                    </div>
                                    <div class="col-7 paddding">
                                        <div class="most_fh5co_treding_font"> Enim ad minim veniam nostrud xercitation ullamco.</div>
                                        <div class="most_fh5co_treding_font_123"> April 18, 2016</div>
                                    </div>
                                </div>
                                <div class="row pb-3">
                                    <div class="col-5 align-self-center">
                                        <img src="images/download (2).jpg" alt="img" class="fh5co_most_trading"/>
                                    </div>
                                    <div class="col-7 paddding">
                                        <div class="most_fh5co_treding_font"> Magna aliqua ut enim ad minim veniam quis nostrud.</div>
                                        <div class="most_fh5co_treding_font_123"> April 18, 2016</div>
                                    </div>
                                </div>
                                <div class="row pb-3">
                                    <div class="col-5 align-self-center"><img src="images/seth-doyle-133175.jpg" alt="img"
                                                                              class="fh5co_most_trading"/></div>
                                    <div class="col-7 paddding">
                                        <div class="most_fh5co_treding_font"> Magna aliqua ut enim ad minim veniam quis nostrud.</div>
                                        <div class="most_fh5co_treding_font_123"> April 18, 2016</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <ul class="pagination justify-content-center" id="carousel-pagination"></ul>
                    </div>
                </div>
            }

        <!-- Developer Section (Max 3 items) -->
        @if (Model.Developer != null && Model.Developer.Any())
        {
            var itemCount = Model.Developer.Count;
            <div class="container-fluid pb-4 pt-5">
                <div class="container animate-box">
                    <div>
                        <div class="fh5co_heading fh5co_heading_border_bottom py-2 mb-4">For Developers</div>
                    </div>
            
                    @if (itemCount > 3)
                    {
                        <div class="owl-carousel owl-theme" id="slider4">
                            @foreach (var post in Model.Developer)
                            {
                                <div class="item px-2">
                                    <div class="fh5co_hover_news_img h-100 d-flex flex-column">
                                        <div class="fh5co_news_img flex-grow-1">
                                            <a asp-controller="Posts" asp-action="Single" 
                                               asp-route-category="@URLHelper.GenerateCategorySlug(post.Categories)" 
                                               asp-route-slug="@post.Slug"
                                               class="h-100 d-block">
                                                <img src="@post.FeatureImageUrl" alt="@post.Title" 
                                                     class="img-fluid h-100 w-100" 
                                                     style="object-fit: cover;">
                                            </a>
                                        </div>
                                        <div class="pt-2">
                                            <div class="pt-2">
                                                <a asp-controller="Posts" asp-action="Single" 
                                                   asp-route-category="@URLHelper.GenerateCategorySlug(post.Categories)" 
                                                   asp-route-slug="@post.Slug" 
                                                   class="d-block fh5co_small_post_heading">
                                                    <span class="">@post.Title</span>
                                                </a>
                                                <div class="c_g">
                                                    <i class="fa fa-clock-o"></i> 
                                                    @post.PublishedDate?.ToString("MMM dd, yyyy")
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            }
                        </div>
                    }
                    else
                    {
                        <div class="row g-4">
                            @foreach (var post in Model.Developer)
                            {
                                <div class="col-xl-4 col-lg-6 col-md-6 col-sm-12">
                                    <div class="fh5co_hover_news_img h-100 d-flex flex-column">
                                        <div class="fh5co_news_img flex-grow-1">
                                            <a asp-controller="Posts" asp-action="Single" 
                                               asp-route-category="@URLHelper.GenerateCategorySlug(post.Categories)" 
                                               asp-route-slug="@post.Slug"
                                               class="h-100 d-block">
                                                <img src="@post.FeatureImageUrl" alt="@post.Title" 
                                                     class="img-fluid h-100 w-100" 
                                                     style="object-fit: cover;">
                                            </a>
                                        </div>
                                        <div class="pt-2">
                                            <div class="pt-2">
                                                <a asp-controller="Posts" asp-action="Single" 
                                                   asp-route-category="@URLHelper.GenerateCategorySlug(post.Categories)" 
                                                   asp-route-slug="@post.Slug" 
                                                   class="d-block fh5co_small_post_heading">
                                                    <span class="">@post.Title</span>
                                                </a>
                                                <div class="c_g">
                                                    <i class="fa fa-clock-o"></i> 
                                                    @post.PublishedDate?.ToString("MMM dd, yyyy")
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            }
                        </div>
                    }
                </div>
            </div>
        }

        @section Scripts {
            <script>
                document.addEventListener('DOMContentLoaded', function() {
                    const itemsPerPage = 4;
                    const totalItems = @Model.HowTo.Count;
                    const totalPages = Math.ceil(totalItems / itemsPerPage);
                    let currentPage = 1;

                    // Hide pagination if there is only one page.
                    const pagerContainer = document.getElementById('carousel-pagination');
                    if (totalPages <= 1) {
                        pagerContainer.style.display = 'none';
                    } else {
                        pagerContainer.style.display = '';
                    }

                    // Function to render the pagination controls
                    function renderPager() {
                        // Clear previous content
                        pagerContainer.innerHTML = '';

                        if (totalPages <= 1) return; // No pagination if only one page

                        // First and Previous links (only if not on first page)
                        if (currentPage > 1) {
                            const firstItem = document.createElement('li');
                            firstItem.className = 'page-item';
                            firstItem.innerHTML = `<a class="page-link" href="#" data-page="1">First</a>`;
                            pagerContainer.appendChild(firstItem);

                            const prevItem = document.createElement('li');
                            prevItem.className = 'page-item';
                            prevItem.innerHTML = `<a class="page-link" href="#" data-page="${currentPage - 1}">Previous</a>`;
                            pagerContainer.appendChild(prevItem);
                        }

                        // Numeric page links – using a sliding window if necessary
                        let startPage = 1, endPage = totalPages;
                        if (totalPages > 10) {
                            startPage = currentPage - 4;
                            endPage = currentPage + 5;
                            if (startPage < 1) { startPage = 1; endPage = 10; }
                            if (endPage > totalPages) { endPage = totalPages; startPage = totalPages - 9; }
                        }
                        for (let p = startPage; p <= endPage; p++) {
                            const pageItem = document.createElement('li');
                            pageItem.className = 'page-item' + (p === currentPage ? ' active' : '');
                            pageItem.innerHTML = `<a class="page-link" href="#" data-page="${p}">${p}</a>`;
                            pagerContainer.appendChild(pageItem);
                        }

                        // Next and Last links (only if not on last page)
                        if (currentPage < totalPages) {
                            const nextItem = document.createElement('li');
                            nextItem.className = 'page-item';
                            nextItem.innerHTML = `<a class="page-link" href="#" data-page="${currentPage + 1}">Next</a>`;
                            pagerContainer.appendChild(nextItem);

                            const lastItem = document.createElement('li');
                            lastItem.className = 'page-item';
                            lastItem.innerHTML = `<a class="page-link" href="#" data-page="${totalPages}">Last</a>`;
                            pagerContainer.appendChild(lastItem);
                        }
                    }

                    // Function to display a specific page of items
                    function showPage(page) {
                        currentPage = page;
                        // Hide all pages
                        document.querySelectorAll('.carousel-page').forEach(function(el) {
                            el.style.display = 'none';
                            el.classList.remove('active');
                        });
                        // Show the items for the selected page
                        document.querySelectorAll(`.carousel-page[data-page="${page}"]`).forEach(function(el) {
                            el.style.display = 'block';
                            setTimeout(() => el.classList.add('active'), 50);
                        });
                        renderPager();
                    }

                    // Initialize first page
                    showPage(currentPage);

                    // Handle clicks on pagination links without page refresh
                    pagerContainer.addEventListener('click', function(e) {
                        e.preventDefault();
                        if (e.target.tagName === 'A') {
                            const newPage = parseInt(e.target.dataset.page);
                            if (!isNaN(newPage)) {
                                showPage(newPage);
                                // Optionally, scroll the carousel into view:
                                document.getElementById('howto-carousel').scrollIntoView({ behavior: "smooth" });
                            }
                        }
                    });
                });
            </script>
        }

    </body>
</html>